<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dashboard - Ascensor Social</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
	<style>
		.neu {
			background: linear-gradient(145deg, #f7fbff, #ffffff);
			border-radius: 12px;
			box-shadow: 8px 8px 16px rgba(180,200,220,0.25), -8px -8px 16px rgba(255,255,255,0.9);
		}
		body { margin: 0; padding: 0; }
		html, body { width: 100%; height: 100%; }
	</style>
</head>
<body class="bg-gray-50 overflow-hidden">
	<div class="flex flex-col h-screen">
		<!-- Header -->
		<header class="flex items-center justify-between p-4 bg-white border-b border-gray-200 flex-shrink-0">
			<div class="flex items-center gap-4">
				<h1 class="text-2xl font-bold text-gray-800">Ascensor Social</h1>
				<div id="city-badge" class="hidden px-4 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-700">
					Filtro: <span id="city-name"></span>
				</div>
			</div>

			<!-- Filtros -->
			<div class="flex items-center gap-3">
				<button id="filters-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
					Filtros ▼
				</button>
			</div>

			<!-- Menú filtros (oculto por defecto) -->
			<div id="filters-menu" class="hidden absolute top-16 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 w-48">
				<div class="space-y-3">
					<button class="filter-city w-full text-left px-3 py-2 rounded hover:bg-blue-50" data-city="madrid">
						<span class="inline-block w-3 h-3 rounded-full bg-blue-500 mr-2"></span>Madrid
					</button>
					<button class="filter-city w-full text-left px-3 py-2 rounded hover:bg-yellow-50" data-city="barcelona">
						<span class="inline-block w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>Barcelona
					</button>
					<button class="filter-city w-full text-left px-3 py-2 rounded hover:bg-orange-50" data-city="valencia">
						<span class="inline-block w-3 h-3 rounded-full bg-orange-500 mr-2"></span>Valencia
					</button>
					<hr class="my-2">
					<button id="clear-filters" class="w-full text-left px-3 py-2 rounded bg-red-100 text-red-700 hover:bg-red-200">
						Limpiar Filtros
					</button>
				</div>
			</div>
		</header>

		<!-- Main Content -->
		<main class="flex-1 p-2 overflow-hidden">
			<div class="grid grid-cols-2 gap-2 h-full">
			<!-- Card 1: Movilidad Ascendente -->
			<div class="neu p-2 flex flex-col">
				<h3 class="text-xs font-bold text-gray-800 mb-1">Movilidad Ascendente</h3>
				<div class="flex-1 min-h-0 relative mb-1">
					<canvas id="chart-movilidad"></canvas>
				</div>
				<div class="text-xs text-gray-700 space-y-0.5 bg-blue-50 p-1.5 rounded">
					<p class="font-semibold text-blue-700">Centil de hijos según padre</p>
					<p>Barras más altas = más ascenso</p>
				</div>
			</div>

			<!-- Card 2: Herencia de Pobreza -->
			<div class="neu p-2 flex flex-col">
				<h3 class="text-xs font-bold text-gray-800 mb-1">Herencia de Pobreza (Q1)</h3>
				<div class="flex-1 flex items-center justify-center min-h-0">
					<div class="w-28 h-28 relative">
						<canvas id="chart-herencia"></canvas>
					</div>
				</div>
				<div class="text-xs text-gray-700 mt-1 space-y-0.5 bg-red-50 p-1.5 rounded">
					<p class="font-semibold text-red-700">% que permanece en Q1</p>
					<div><span class="inline-block w-1.5 h-1.5 rounded-full bg-red-500 mr-1"></span>Quedan: 24.9%</div>
					<div><span class="inline-block w-1.5 h-1.5 rounded-full bg-green-500 mr-1"></span>Salen: 75.1%</div>
				</div>
			</div>

			<!-- Card 3: Destino Hijos -->
			<div class="neu p-2 flex flex-col">
				<h3 class="text-xs font-bold text-gray-800 mb-1">Destino de Hijos (Q1→)</h3>
				<div class="flex-1 flex items-center justify-center min-h-0">
					<div class="w-24 h-24 relative">
						<canvas id="chart-destino"></canvas>
					</div>
				</div>
				<div class="text-xs text-gray-700 mt-1 bg-purple-50 p-1.5 rounded">
					<p class="font-semibold text-purple-700 mb-0.5">A dónde llegan los hijos</p>
					<div class="grid grid-cols-2 gap-0.5">
						<span><span class="inline-block w-1.5 h-1.5 rounded-full bg-red-500 mr-1"></span>Q1: 24.9%</span>
						<span><span class="inline-block w-1.5 h-1.5 rounded-full bg-orange-500 mr-1"></span>Q2: 22.6%</span>
						<span><span class="inline-block w-1.5 h-1.5 rounded-full bg-yellow-400 mr-1"></span>Q3: 21.8%</span>
						<span><span class="inline-block w-1.5 h-1.5 rounded-full bg-blue-500 mr-1"></span>Q4: 18.1%</span>
						<span class="col-span-2"><span class="inline-block w-1.5 h-1.5 rounded-full bg-indigo-600 mr-1"></span>Q5: 12.6%</span>
					</div>
				</div>
			</div>

			<!-- Card 4: Ranking Regional -->
			<div class="neu p-2 flex flex-col">
				<h3 class="text-xs font-bold text-gray-800 mb-1">Mejores Regiones</h3>
				<p class="text-xs text-gray-600 mb-1 font-semibold">Movilidad ascendente media</p>
				<div class="flex-1 overflow-y-auto space-y-0.5">
					<div class="flex justify-between items-center p-1 bg-green-50 rounded text-xs">
						<span>1. Cataluña</span>
						<span class="bg-green-200 px-1.5 py-0.5 rounded font-bold text-xs">54.5</span>
					</div>
					<div class="flex justify-between items-center p-1 bg-green-50 rounded text-xs">
						<span>2. Aragón</span>
						<span class="bg-green-200 px-1.5 py-0.5 rounded font-bold text-xs">53.6</span>
					</div>
					<div class="flex justify-between items-center p-1 bg-green-50 rounded text-xs">
						<span>3. La Rioja</span>
						<span class="bg-green-200 px-1.5 py-0.5 rounded font-bold text-xs">52.3</span>
					</div>
					<div class="flex justify-between items-center p-1 bg-blue-50 rounded text-xs">
						<span>4. Madrid</span>
						<span class="bg-blue-200 px-1.5 py-0.5 rounded font-bold text-xs">51.5</span>
					</div>
					<div class="flex justify-between items-center p-1 bg-blue-50 rounded text-xs">
						<span>5. Baleares</span>
						<span class="bg-blue-200 px-1.5 py-0.5 rounded font-bold text-xs">51.4</span>
					</div>
				</div>
			</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script>
		// Datos por ciudad
		const cityData = {
			nacional: {
				name: 'Nacional',
				movilidad: [43, 42, 41, 41, 42, 43, 44, 45, 46, 47],
				herencia: [24.9, 75.1],
				destino: [24.89, 22.57, 21.80, 18.12, 12.61],
				color: 'rgba(96,165,250,0.8)',
				borderColor: 'rgba(59,130,246,1)'
			},
			madrid: {
				name: 'Madrid',
				movilidad: [45, 44, 43, 42, 43, 44, 46, 47, 48, 49],
				herencia: [22.5, 77.5],
				destino: [22.5, 21, 22, 19.5, 15],
				color: 'rgba(59,130,246,0.8)',
				borderColor: 'rgba(37,99,235,1)'
			},
			barcelona: {
				name: 'Barcelona',
				movilidad: [50, 49, 48, 48, 49, 50, 51, 52, 53, 54],
				herencia: [20, 80],
				destino: [20, 19, 21, 20, 20],
				color: 'rgba(234,179,8,0.8)',
				borderColor: 'rgba(202,138,4,1)'
			},
			valencia: {
				name: 'Valencia',
				movilidad: [46, 45, 44, 43, 44, 45, 46, 47, 48, 49],
				herencia: [23, 77],
				destino: [23, 21.5, 21.5, 18.5, 15.5],
				color: 'rgba(249,115,22,0.8)',
				borderColor: 'rgba(234,88,12,1)'
			}
		};

		let currentCity = 'nacional';
		let charts = {};

		// Inicializar gráficos
		function initCharts() {
			// 1. Movilidad Ascendente
			const ctx1 = document.getElementById('chart-movilidad').getContext('2d');
			charts.movilidad = new Chart(ctx1, {
				type: 'bar',
				data: {
					labels: ['1-10', '11-20', '21-30', '31-40', '41-50', '51-60', '61-70', '71-80', '81-90', '91-100'],
					datasets: [{
						label: 'Centil Promedio',
						data: cityData[currentCity].movilidad,
						backgroundColor: cityData[currentCity].color,
						borderColor: cityData[currentCity].borderColor,
						borderWidth: 2
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false }
					},
					scales: {
						y: { max: 100, grid: { display: false } },
						x: { grid: { display: false } }
					}
				}
			});

			// 2. Herencia de Pobreza
			const ctx2 = document.getElementById('chart-herencia').getContext('2d');
			charts.herencia = new Chart(ctx2, {
				type: 'doughnut',
				data: {
					labels: ['Permanecen Q1', 'Ascienden'],
					datasets: [{
						data: cityData[currentCity].herencia,
						backgroundColor: ['#EF4444', '#FBBF24']
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false }
					}
				}
			});

			// 3. Destino de Hijos
			const ctx3 = document.getElementById('chart-destino').getContext('2d');
			charts.destino = new Chart(ctx3, {
				type: 'pie',
				data: {
					labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q5'],
					datasets: [{
						data: cityData[currentCity].destino,
						backgroundColor: ['#EF4444', '#F97316', '#FBBF24', '#3B82F6', '#6366F1']
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false }
					}
				}
			});
		}

		// Actualizar gráficos
		function updateCharts() {
			const data = cityData[currentCity];
			
			charts.movilidad.data.datasets[0].data = data.movilidad;
			charts.movilidad.data.datasets[0].backgroundColor = data.color;
			charts.movilidad.data.datasets[0].borderColor = data.borderColor;
			charts.movilidad.update();

			charts.herencia.data.datasets[0].data = data.herencia;
			charts.herencia.update();

			charts.destino.data.datasets[0].data = data.destino;
			charts.destino.update();
		}

		// Event Listeners - Filtros
		document.getElementById('filters-btn').addEventListener('click', () => {
			document.getElementById('filters-menu').classList.toggle('hidden');
		});

		// Cerrar menú al hacer clic afuera
		document.addEventListener('click', (e) => {
			const menu = document.getElementById('filters-menu');
			const btn = document.getElementById('filters-btn');
			if (!menu.contains(e.target) && !btn.contains(e.target)) {
				menu.classList.add('hidden');
			}
		});

		// Filtros por ciudad
		document.querySelectorAll('.filter-city').forEach(btn => {
			btn.addEventListener('click', () => {
				currentCity = btn.dataset.city;
				updateCharts();

				// Mostrar badge
				const badge = document.getElementById('city-badge');
				document.getElementById('city-name').textContent = cityData[currentCity].name;
				badge.classList.remove('hidden');

				// Cerrar menú
				document.getElementById('filters-menu').classList.add('hidden');
			});
		});

		// Limpiar filtros
		document.getElementById('clear-filters').addEventListener('click', () => {
			currentCity = 'nacional';
			updateCharts();
			document.getElementById('city-badge').classList.add('hidden');
			document.getElementById('filters-menu').classList.add('hidden');
		});

		// Inicializar al cargar
		window.addEventListener('load', () => {
			initCharts();
		});
	</script>
</body>
</html>

